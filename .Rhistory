values_to = "value") %>%
ggplot(aes(x = value)) +
geom_bar() +
facet_wrap(~ variable, scales = "free_x") +
theme_bw()
data_3 <- data_3 %>%
mutate(
TreatmentGroup = factor(TreatmentGroup, levels = c(0,1), labels = c("Control","Treatment")),
Sex            = factor(Sex,            levels = c(0,1), labels = c("Male","Female")),
ECOG_PS        = factor(ECOG_PS, ordered = TRUE)
)
data_3 <- data_3 %>%
mutate(
TreatmentGroup = factor(TreatmentGroup, levels = c(0,1), labels = c("Control","Treatment")),
Sex            = factor(Sex,            levels = c(0,1), labels = c("Male","Female")),
ECOG_PS        = factor(ECOG_PS, ordered = TRUE)
)
data_3 %>%
pivot_longer(cols = c(Sex, ECOG_PS),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value, fill = TreatmentGroup)) +
geom_bar(position = "fill") +   # 100% stacked bar
facet_wrap(~ variable, scales = "free_x") +
scale_y_continuous(labels = scales::percent) +
ylab("Proportion") +
theme_bw()
data_3 %>%
pivot_longer(cols = c(Sex, ECOG_PS),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value, fill = TreatmentGroup)) +
geom_bar(position = "dodge") +
facet_wrap(~ variable, scales = "free_x") +
theme_bw()
# Install Packages (install once if needed)
#install.packages(c("readr","dplyr","ggplot2", "corrplot", "survminer"))
library(readr)
library(dplyr)
library(ggplot2)
library(corrplot)
library(tidyr)
library(survival)
library(survminer)
# === SETUP ====================================================================
# NOTE: Adjust path as needed.
# Load data (long format)
data_3 <- read_csv("Data_T3.csv", show_col_types = FALSE)
# Drop first (index) column
data_3 <- data_3[,-1]
# Get numerical and categorical data
data_3_num <- data_3[sapply(data_3, is.numeric)]
data_3_cat <- data_3[!sapply(data_3, is.numeric)]
# Convert categorical variables to numeric (0/1)
data_3$TreatmentGroup <- ifelse(data_3$TreatmentGroup == "Treatment", 1, 0)
data_3$Sex <- ifelse(data_3$Sex == "Female", 1, 0)
# MISSING DATA?
#
# Histogram plots for continuous variables (Age, GFR, Time)
data_3 %>%
pivot_longer(cols = c(Age, GFR, Time),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_histogram(bins = 30, colour = "black") +
facet_wrap(~ variable, scales = "free") +
theme_bw()
# Bar plots for categorical variables (TreatmentGroup, Sex, ECOG_PS)
data_3 %>%
pivot_longer(cols = c(TreatmentGroup, Sex, ECOG_PS),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_bar() +
facet_wrap(~ variable, scales = "free_x") +
theme_bw()
# Age by treatment group
boxplot(Age ~ TreatmentGroup,
data = data_3,
col = c("lightblue", "lightgreen"),
xlab = "Treatment Group",
ylab = "Age (years)",
main = "Age Distribution by Treatment Group")
# GFR by treatment group
boxplot(GFR ~ TreatmentGroup,
data = data_3,
col = c("lightblue", "lightgreen"),
xlab = "Treatment Group",
ylab = "GFR (mL/min/1.73m²)",
main = "GFR Distribution by Treatment Group")
# Bar plots for categorical variables (TreatmentGroup, Sex, ECOG_PS)
data_3 %>%
pivot_longer(cols = c(TreatmentGroup, Sex, ECOG_PS),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_bar() +
facet_wrap(~ variable, scales = "free_x") +
theme_bw()
# Histogram plots for continuous variables (Age, GFR, Time)
data_3 %>%
pivot_longer(cols = c(Age, GFR, Time),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_histogram(bins = 30, colour = "black") +
facet_wrap(~ variable, scales = "free") +
theme_bw()
# Bar plots for categorical variables (TreatmentGroup, Sex, ECOG_PS)
data_3 %>%
pivot_longer(cols = c(TreatmentGroup, Sex, ECOG_PS),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_bar() +
facet_wrap(~ variable, scales = "free_x") +
theme_bw()
# Age by treatment group
boxplot(Age ~ TreatmentGroup,
data = data_3,
col = c("lightblue", "lightgreen"),
xlab = "Treatment Group",
ylab = "Age (years)",
main = "Age Distribution by Treatment Group")
# GFR by treatment group
boxplot(GFR ~ TreatmentGroup,
data = data_3,
col = c("lightblue", "lightgreen"),
xlab = "Treatment Group",
ylab = "GFR (mL/min/1.73m²)",
main = "GFR Distribution by Treatment Group")
# Column-wise count of missing values
colSums(is.na(data_3))
# (Optional) proportion of missing per variable
colMeans(is.na(data_3))
is.na(data_3)
min(is.na(data_3))
max(is.na(data_3))
# = covariance matrix ==========================================
# The covariance matrix contains the covariances between all pairs of variables.
# Each entry tells you how two variables vary together in absolute terms,
# in the original units of the data.
# Compute covariance matrix (only continuous variables - hence, data_3_num)
cov_mat <- cov(data_3_num)
# Plot covariance matrix with circles (size & color show magnitude and sign)
corrplot(cov_mat,
is.corr    = FALSE,                # this tells corrplot it's covariance, not correlation
method      = "circle",            # circles encode strength by size and color
type        = "upper",             # show lower triangle only
col         = colorRampPalette(c("blue", "white", "red"))(200),
addCoef.col = NA,                  # optional: don't add numbers
tl.col      = "black",             # text label color
tl.srt      = 45,                  # label rotation
title       = "Covariance Matrix",
mar         = c(0,0,2,0))
# The diagonal values show large differences in variance across variables,
# reflecting their different measurement scales. ID has an especially large
# variance because it is an identifier rather than a true variable. Off-diagonal
# covariances are small, confirming weak co-variation between variables. This
# means the variables vary mostly independently, though their scales differ
# substantially.
cor_mat <- cor(data_3_num, use = "pairwise.complete.obs")
corrplot(cor_mat,
method        = "circle",           # circles encode magnitude
type          = "upper",            # show lower triangle only
diag          = TRUE,               # keep diagonal
order         = "original",         # keep your column order
col           = colorRampPalette(c("red","white","blue"))(200),
addCoef.col   = NA,                 # no numbers in cells
tl.col        = "red",              # red axis labels
tl.srt        = 45,                 # rotate labels
tl.cex        = 1.2,                # label size
addgrid.col   = "grey90",           # light grid
cl.ratio      = 0.2,                # thinner colorbar
mar           = c(0,0,2,0),
title         = "Correlation of Independent Variables"
)
corrplot(cov_mat,
is.corr    = FALSE,                # this tells corrplot it's covariance, not correlation
method      = "circle",            # circles encode strength by size and color
type        = "upper",             # show lower triangle only
col         = colorRampPalette(c("blue", "white", "red"))(200),
addCoef.col = NA,                  # optional: don't add numbers
tl.col      = "black",             # text label color
tl.srt      = 45,                  # label rotation
title       = "Covariance matrix of independent variables",
mar         = c(0,0,2,0))
cor_mat <- cor(data_3_num, use = "pairwise.complete.obs")
corrplot(cor_mat,
method        = "circle",           # circles encode magnitude
type          = "upper",            # show lower triangle only
diag          = TRUE,               # keep diagonal
order         = "original",         # keep your column order
col           = colorRampPalette(c("red","white","blue"))(200),
addCoef.col   = NA,                 # no numbers in cells
tl.col        = "red",              # red axis labels
tl.srt        = 45,                 # rotate labels
tl.cex        = 1.2,                # label size
addgrid.col   = "grey90",           # light grid
cl.ratio      = 0.2,                # thinner colorbar
mar           = c(0,0,2,0),
title         = "Correlation of independent variables"
)
max()# Set layout: 1 row, 2 columns
par(mfrow = c(1, 2))
# === Covariance matrix plot =======================================
cov_mat <- cov(data_3_num)
corrplot(cov_mat,
is.corr    = FALSE,
method      = "circle",
type        = "upper",
col         = colorRampPalette(c("blue", "white", "red"))(200),
addCoef.col = NA,
tl.col      = "black",
tl.srt      = 45,
title       = "Covariance matrix of independent variables",
mar         = c(0,0,2,0))
# === Correlation matrix plot =======================================
cor_mat <- cor(data_3_num, use = "pairwise.complete.obs")
corrplot(cor_mat,
method        = "circle",
type          = "upper",
diag          = TRUE,
order         = "original",
col           = colorRampPalette(c("red","white","blue"))(200),
addCoef.col   = NA,
tl.col        = "red",
tl.srt        = 45,
tl.cex        = 1.2,
addgrid.col   = "grey90",
cl.ratio      = 0.2,
mar           = c(0,0,2,0),
title         = "Correlation of independent variables")
# Set 1 row, 2 columns
par(mfrow = c(1, 2))
# --- Age by treatment group ---------------------------------------
boxplot(Age ~ TreatmentGroup,
data = data_3,
col = c("lightblue", "lightgreen"),
xlab = "Treatment Group",
ylab = "Age (years)",
main = "Age Distribution by Treatment Group")
# --- GFR by treatment group ---------------------------------------
boxplot(GFR ~ TreatmentGroup,
data = data_3,
col = c("lightblue", "lightgreen"),
xlab = "Treatment Group",
ylab = "GFR (mL/min/1.73m²)",
main = "GFR Distribution by Treatment Group")
# === Boxplots ===========================================================
# Set 1 row, 2 columns
par(mfrow = c(1, 2))
# --- Age by treatment group ---------------------------------------
boxplot(Age ~ TreatmentGroup,
data = data_3,
col = c("lightblue", "lightgreen"),
xlab = "Treatment Group",
ylab = "Age (years)",
main = "Age Distribution by Treatment Group")
# --- GFR by treatment group ---------------------------------------
boxplot(GFR ~ TreatmentGroup,
data = data_3,
col = c("lightblue", "lightgreen"),
xlab = "Treatment Group",
ylab = "GFR (mL/min/1.73m²)",
main = "GFR Distribution by Treatment Group")
library(tidyverse)
library(patchwork)
p1 <- data_3 %>%
pivot_longer(cols = c(Age, GFR, Time),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_histogram(bins = 30, colour = "black") +
facet_wrap(~ variable, scales = "free") +
theme_bw() +
ggtitle("Continuous Variables")
# Bar plots
p2 <- data_3 %>%
pivot_longer(cols = c(TreatmentGroup, Sex, ECOG_PS),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_bar() +
facet_wrap(~ variable, scales = "free_x") +
theme_bw() +
ggtitle("Categorical Variables")
# Put side by side
p1 + p2
cov_mat <- cov(data_3_num)
corrplot(cov_mat,
is.corr    = FALSE,
method      = "circle",
type        = "upper",
col         = colorRampPalette(c("blue", "white", "red"))(200),
addCoef.col = NA,
tl.col      = "black",
tl.srt      = 45,
title       = "Covariance matrix of independent variables",
mar         = c(0,0,2,0))
# === Correlation matrix plot =======================================
cor_mat <- cor(data_3_num, use = "pairwise.complete.obs")
corrplot(cor_mat,
method        = "circle",
type          = "upper",
diag          = TRUE,
order         = "original",
col           = colorRampPalette(c("red","white","blue"))(200),
addCoef.col   = NA,
tl.col        = "red",
tl.srt        = 45,
tl.cex        = 1.2,
addgrid.col   = "grey90",
cl.ratio      = 0.2,
mar           = c(0,0,2,0),
title         = "Correlation of independent variables")
# Example: visualize Age and GFR
num_vars <- c("Age", "GFR", "ECOG_PS", "Time")
data_long <- data_3 %>%                              # start from original
select(any_of(num_vars)) %>%                       # don't error if a name is missing
mutate(across(everything(), as.numeric)) %>%       # ensure numeric
tidyr::pivot_longer(cols = everything(),
names_to = "Variable",
values_to = "Value")
ggplot(data_long, aes(x = Value)) +
geom_histogram(color = "black", bins = 20) +
facet_wrap(~ Variable, scales = "free") +
theme_minimal() +
labs(title = "Distribution of Numeric Variables")
ggplot(data_3, aes(x = TreatmentGroup, y = GFR, fill = TreatmentGroup)) +
geom_boxplot(alpha = 0.7) +
theme_minimal() +
labs(title = "GFR by Treatment Group", x = "Treatment Group", y = "GFR (mL/min/1.73m²)")
ggplot(data_3, aes(x = Sex, y = GFR, fill = Sex)) +
geom_boxplot(alpha = 0.7) +
theme_minimal() +
labs(title = "GFR by Sex", x = "Sex", y = "GFR (mL/min/1.73m²)")
ggplot(data_3, aes(x = Sex, y = Age, fill = Sex)) +
geom_boxplot(alpha = 0.7) +
theme_minimal() +
labs(title = "Age Distribution by Sex", x = "Sex", y = "Age (years)")
ggplot(data_3, aes(x = Time, y = GFR, fill = Sex)) +
geom_boxplot(alpha = 0.7) +
theme_minimal() +
labs(title = "GFR by Sex", x = "Sex", y = "GFR (mL/min/1.73m²)")
# Install Packages (install once if needed)
#install.packages(c("readr","dplyr","ggplot2", "corrplot", "survminer"))
library(readr)
library(dplyr)
library(ggplot2)
library(corrplot)
library(tidyr)
library(survival)
library(survminer)
# === SETUP ====================================================================
# NOTE: Adjust path as needed.
# Load data (long format)
data_3 <- read_csv("Data_T3.csv", show_col_types = FALSE)
# Drop first (index) column
data_3 <- data_3[,-1]
# Get numerical and categorical data
data_3_num <- data_3[sapply(data_3, is.numeric)]
data_3_cat <- data_3[!sapply(data_3, is.numeric)]
# Convert categorical variables to numeric (0/1)
data_3$TreatmentGroup <- ifelse(data_3$TreatmentGroup == "Treatment", 1, 0)
data_3$Sex <- ifelse(data_3$Sex == "Female", 1, 0)
# === MISSING DATA =============================================================
# Column-wise count of missing values
colSums(is.na(data_3))
# Proportion of missing per variable
colMeans(is.na(data_3))
#  =============================================================================
# Histogram plots for continuous variables (Age, GFR, Time)
data_3 %>%
pivot_longer(cols = c(Age, GFR, Time),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_histogram(bins = 30, colour = "black") +
facet_wrap(~ variable, scales = "free") +
theme_bw()
# Bar plots for categorical variables (TreatmentGroup, Sex, ECOG_PS)
data_3 %>%
pivot_longer(cols = c(TreatmentGroup, Sex, ECOG_PS),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_bar() +
facet_wrap(~ variable, scales = "free_x") +
theme_bw()
# === Boxplots ===========================================================
# Set 1 row, 2 columns
par(mfrow = c(1, 2))
# --- Age by treatment group ---------------------------------------
boxplot(Age ~ TreatmentGroup,
data = data_3,
col = c("lightblue", "lightgreen"),
xlab = "Treatment Group",
ylab = "Age (years)",
main = "Age Distribution by Treatment Group")
# --- GFR by treatment group ---------------------------------------
boxplot(GFR ~ TreatmentGroup,
data = data_3,
col = c("lightblue", "lightgreen"),
xlab = "Treatment Group",
ylab = "GFR (mL/min/1.73m²)",
main = "GFR Distribution by Treatment Group")
# === Covariance and Correlation matrices ======================================
# The covariance matrix contains the covariances between all pairs of variables.
# Each entry tells you how two variables vary together in absolute terms,
# in the original units of the data.
# The diagonal values show large differences in variance across variables,
# reflecting their different measurement scales. ID has an especially large
# variance because it is an identifier rather than a true variable. Off-diagonal
# covariances are small, confirming weak co-variation between variables. This
# means the variables vary mostly independently, though their scales differ
# substantially.
# The correlation matrix is a standardized version of the covariance matrix:
# This re-scales everything so that:
#  * Diagonal entries = 1
#  * Off-diagonal entries = correlations between -1 and +1
# So it only tells you about direction and strength of linear relationships,
#not their magnitude in the data’s units.
# The variables show very weak correlations, mostly between –0.2 and +0.2,
# indicating that they are largely independent. This suggests there is no
# multicollinearity among the independent variables, which is good for modeling.
# The only mildly positive relationships are between GFR and Time (r ≈ 0.22)
# and between ECOG_PS and Event (r ≈ 0.20), but these are still weak.
# Set layout: 1 row, 2 columns
par(mfrow = c(1, 2))
# === Covariance matrix plot =======================================
cov_mat <- cov(data_3_num)
corrplot(cov_mat,
is.corr    = FALSE,
method      = "circle",
type        = "upper",
col         = colorRampPalette(c("blue", "white", "red"))(200),
addCoef.col = NA,
tl.col      = "black",
tl.srt      = 45,
title       = "Covariance matrix of independent variables",
mar         = c(0,0,2,0))
# === Correlation matrix plot =======================================
cor_mat <- cor(data_3_num, use = "pairwise.complete.obs")
corrplot(cor_mat,
method        = "circle",
type          = "upper",
diag          = TRUE,
order         = "original",
col           = colorRampPalette(c("red","white","blue"))(200),
addCoef.col   = NA,
tl.col        = "red",
tl.srt        = 45,
tl.cex        = 1.2,
addgrid.col   = "grey90",
cl.ratio      = 0.2,
mar           = c(0,0,2,0),
title         = "Correlation of independent variables")
# NOTE: Adjust path as needed.
# Load data (long format)
data_3 <- read_csv("Data_T3.csv", show_col_types = FALSE)
# Drop first (index) column
data_3 <- data_3[,-1]
# Get numerical and categorical data
data_3_num <- data_3[sapply(data_3, is.numeric)]
data_3_cat <- data_3[!sapply(data_3, is.numeric)]
# Convert categorical variables to numeric (0/1)
data_3$TreatmentGroup <- ifelse(data_3$TreatmentGroup == "Treatment", 1, 0)
data_3$Sex <- ifelse(data_3$Sex == "Female", 1, 0)
View(data_3)
# === MISSING DATA =============================================================
# Column-wise count of missing values
colSums(is.na(data_3))
# Proportion of missing per variable
colMeans(is.na(data_3))
#  =============================================================================
# Histogram plots for continuous variables (Age, GFR, Time)
data_3 %>%
pivot_longer(cols = c(Age, GFR, Time),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_histogram(bins = 30, colour = "black") +
facet_wrap(~ variable, scales = "free") +
theme_bw()
# Bar plots for categorical variables (TreatmentGroup, Sex, ECOG_PS)
data_3 %>%
pivot_longer(cols = c(TreatmentGroup, Sex, ECOG_PS),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_bar() +
facet_wrap(~ variable, scales = "free_x") +
theme_bw()
# Histogram plots for continuous variables (Age, GFR, Time)
data_3 %>%
pivot_longer(cols = c(Age, GFR, Time),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_histogram(bins = 30, colour = "black") +
facet_wrap(~ variable, scales = "free") +
theme_bw()
# Bar plots for categorical variables (TreatmentGroup, Sex, ECOG_PS)
data_3 %>%
pivot_longer(cols = c(TreatmentGroup, Sex, ECOG_PS),
names_to = "variable",
values_to = "value") %>%
ggplot(aes(x = value)) +
geom_bar() +
facet_wrap(~ variable, scales = "free_x") +
theme_bw()
